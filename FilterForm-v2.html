<!DOCTYPE html>
<html>
<head>
    <title>Page Title</title>
</head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="src/jquery.table2excel.js"></script>
<body>


    <script>
    var statusOption=["Awaiting Customer Approval","Order Part","On Order","Received","Installed","Wrong Part","Bad/Damaged Part","Abandoned Part","Unable to Locate Part","Shipped"]

    $(function()
    {
        generateStatusOnOffCheckbox();
    });

    $(document).ready(function()
    {
        $("#btnExportExcel").click(function()
        {
            var currentdate = new Date();
            var datetime =
            + currentdate.getFullYear()+ "/"
            + (currentdate.getMonth()+1)  + "/"
            +currentdate.getDate() + " "

            + currentdate.getHours() + ":"
            + currentdate.getMinutes() + ":"
            + currentdate.getSeconds() + "Order List";

            $("#table").table2excel(
                {
                    exclude:".noExl",
                    name:"Worksheet Name",
                    filename:datetime,
                    fileext:".xls"
                });

            });
            $("#txt").keyup(function()
            {
                statusFilter();
                //$("#aa").html(t);
            });
        });
        function statusFilter()
        {
            $("tr[name ='tblTr']").remove();
            var v=$("#txt").val();
            //alert(v.split('\t')[1]);
            var sp=v.split("close add to cart");
            var t="";





            //////////////////
            for(var c=0;c<sp.length;c++)
            {
                var txtReturn="";
                var rtn;
    //            statusOption

                statusOption.forEach((sopt,index) =>
                {
                    if(sp[c].includes(sopt)==true)
                    {
                        txtReturn=sopt;
                        rtn=txtFilter(c,sp[c],sopt);
                        return;
                    }
                })
                /*
                if(sp[c].includes()==true)
                {
                    txtReturn="R";
                    rtn=txtFilter(c,sp[c],"Received");
                }*/
                /*if(sp[c].includes("Received")==true)
                {
                    txtReturn="R";
                    rtn=txtFilter(c,sp[c],"Received");
                }
                else if(sp[c].includes("Order Part")==true)
                {
                    txtReturn="O";
                    rtn=txtFilter(c,sp[c],"Order Part");
                }
                else if(sp[c].includes("Installed")==true)
                {
                    txtReturn="I";
                    rtn=txtFilter(c,sp[c],"Installed");
                }
                else
                {
                    txtReturn="N";
                }
                */

                generateTable(rtn);
                /*
                t+=c+". "+sp[c]+"<br>"+
                "status = "+txtReturn+"<br>"+
                "~~~"+rtn[0]+"<br>"+
                "Note = "+rtn[1]+"<br>"+
                "WO   = "+rtn[2]+"<br>"+
                "Quantity = "+rtn[3]+"<br>"+
                "Name = "+rtn[4]+"<br>"+

                "<br><br>";*/
            }
        }
        function txtFilter(no,txtAry,status)
        {
            var rAry = new Array();
            var txt=txtAry;

            /*
            HG - iPad 5 LCD	1
            $0.00
            $0.00				Repair at AMK	2021-05-20	'v3'v1 Installed'
            for testing	'v4 #28626''	 'v2 delete edit'
            'v0 close add to cart'
            */

            //v1
            var locStatus=txt.search(status);
            //v2
            txt=txt.replace("delete", "");
            txt=txt.replace("edit", "");
            //v3
            var txtSubString="";
            txtSubString=txt.substring(locStatus);
            txtSubString=txtSubString.replace(status, "");
            //v4
            var LocWO=txtSubString.search("#");
            var txtWO="";
            if(LocWO != -1)
            {
                txtWO=txtSubString.substring(LocWO);
                txtSubString=txtSubString.replace(txtWO, "");
            }
            //v5
            txt=txt.replace(txtSubString, "");
            txt=txt.replace(status, "");

            //v6

            //v1
            //var locQuantity=$("#txt").val().search('\t');
            //v2
            //var txtQuantity=$("#txt").val().substring(locQuantity);
            //v3
            //var locPrice=txtQuantity.search('$0.00');
            //v4
            //var Quantity=txtQuantity.substring(locPrice);

            //var aa = $("#txt").val().substring(locQuantity,$("#txt").val().lastIndexOf("$"));

            //var aa = $("#txt").val().split('\t').pop().split('$')[0];

            var txtQuantity = txt.split('\t')[1];
            txtQuantity = txtQuantity.split('$')[0];

            var txtName = txt.split('\t')[0];

            rAry[0]=no;
            rAry[1]=txtName;
            rAry[2]=txtQuantity;
            rAry[3]=txtWO;
            rAry[4]=txtSubString;
            rAry[5]=txt;
            rAry[6]=status;



            /*  locStatus+
            "<br> txtSubString ="+txtSubString+
            "<br> txtWO ="+txtWO;*/
            return rAry;
        }
        function generateTable(ary)
        {
            var tbl=$("#table");

            var tr=$("<tr></tr>");
            tr.attr({"name": "tblTr"})
            tbl.append(tr);


            var td0=$("<td></td>");
            td0.html((ary[0]+1));

            var td1=$("<td></td>");
            td1.html(ary[1]);

            var td2=$("<td></td>");
            td2.html(ary[2]);
            td2.css({"text-align": "center"});

            var td3=$("<td></td>");
            td3.html(ary[6]);

            var td4=$("<td></td>");
            td4.html(ary[3]);

            tr.append(td0);
            tr.append(td1);
            tr.append(td2);
            tr.append(td3);
            tr.append(td4);
        }

        function generateStatusOnOffCheckbox()
        {
            var divStatus = $("#divStatusOnOffCheckBox");
            var table=$("<table></table>");
            divStatus.append(table);

            var c=1;





            statusOption.forEach((sopt,index) =>
            {
                var tr
                if(c%3==0)
                {
                    var tr
                }
                //var aa = $("#aa");
                //aa.html(aa.html()+"<br>"+sopt);
                //,{"":""},{"":""}
                $('<input />', { type: 'checkbox', id: 'cb'+index, name: 'cbStatus', value: sopt }).appendTo(divStatus);
                $('<label />', { 'for': 'cb'+index, text: sopt }).appendTo(divStatus);
            })


        }
        </script>

        <textarea id="txt" rows="10" cols="90"></textarea>
        <div id="aa">
            <p style="background-color:red;padding: 5px;font-size: 20px;font-weight: bold;"> ignore red background color element/item</p>
        </div>

        <div id="divStatusOnOffCheckBox" style="background-color:red">
        Filter Status</div>
        <div>
            <button id="btnExportExcel">ExportExcel</button>
        </div>

        <table id="table">
            <tr>
                <th>No.</th>
                <th>Name</th>
                <th>Quantity</th>
                <th>Status</th>
                <th>WO#</th>
            </tr>
        </table>

    </body>
    </html>
